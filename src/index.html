<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      .container {
        width: 100%;
        height: 100vh;
        background-color: #fafafa;
        display: flex;
        justify-content: center;
        align-items: stretch;
      }
      .item {
        border: solid 2px #eee;
        width: 50%;
        white-space: pre-wrap;
        position: relative;
      }
      .item textarea {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="item" id="source">
        <textarea></textarea>
      </div>
      <div class="item" id="result">
        <textarea></textarea>
      </div>
    </div>
    <script>
      const createTypeDefine = (jsonData) => {
        const transTypeMap = {
          string: "string",
          integer: "number",
          array: "[]",
        };

        const prefixIndent = (str, indent = 0, step = "  ") => {
          return `${step.repeat(indent)}${str}`;
        };
        const addRow = (str, indent, step) => {
          return `${prefixIndent(str, indent, step)}\n`;
        };

        const transProperties = (value, indent, parentDescription = "") => {
          let str = "";
          let description = value.description
            ? `  // ${value.description}`
            : "";

          if (value.originalRef) {
            str += `${value.originalRef}`;
          } else {
            switch (value.type) {
              case "object":
                str += addRow(`{${parentDescription}`);
                for (const key in value.properties) {
                  str += addRow(
                    `${key}: ${transProperties(
                      value.properties[key],
                      indent + 2,
                      description
                    )}`,
                    indent + 1
                  );
                }
                str += prefixIndent("}", indent);
                break;
              case "array":
                str += `${transProperties(value.items, indent, description)}${
                  transTypeMap[value.type]
                }`;
                break;
              default:
                str += `${transTypeMap[value.type]}`;
            }
          }
          return str;
        };
        const transDefineToType = (jsonSchema, indent = 0) => {
          let str = "";
          str += addRow(`// ${jsonSchema.title}`, indent);
          str += addRow(`export type ${jsonSchema.title} = {`, indent);
          for (const key in jsonSchema.properties) {
            const value = jsonSchema.properties[key];
            let description = value.description
              ? `  // ${value.description}`
              : "";
            str += addRow(
              `${key} : ${transProperties(value, indent + 1)};${
                ["array", "object"].includes(value.type) ? "" : description
              }`,
              indent + 1
            );
          }
          str += addRow(`};`, indent);
          return str;
        };
        const { definitions } = jsonData;
        let result = "";
        for (const key in definitions) {
          const value = definitions[key];
          result += addRow(`${transDefineToType(value)}`);
        }
        return result;
      };
      document
        .querySelector("#source textarea")
        .addEventListener("change", (evt) => {
          const jsonData = JSON.parse(evt.target.value);
          const result = createTypeDefine(jsonData);
          document.querySelector("#result textarea").value = result;
        });
    </script>
  </body>
</html>
